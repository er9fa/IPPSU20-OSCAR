<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
<style>

/* title of the page */
h1 {
    text-align: center;
    font-size: 60px;
    color: white;
    text-shadow: 5px 5px 3px #999;
    font-family: 'Orbitron', sans-serif;
}

/* button that controls basic functions including user relation to space objects */
.compute button {
  background-color: transparent;
  border: 3px solid #C0ECAD;
  border-radius: 50px;
  color: white ;
  padding: 10px 24px;
  cursor: pointer;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  font-family: "Helvetica";
  font-weight: bold;
}
.compute button:hover {
  background-color: gray;
}

/* general features of the background */
body {
  /* background image is copyright free */
  background: url(https://images.unsplash.com/photo-1587465511660-05c929e0e874?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1651&q=80);
  background-size: cover;
  background-attachment: fixed;
  text-align: center;
}

/**/
label {
  font-size: 16px;
}

/**/
input[type=text] {
  background-color: transparent;
  color: white;
  border-radius: 50px;
}

/**/
p {
  color: white;
}

/**/
.textbox {
  font-family: "Helvetica";
  font-weight: 100;
  margin: 1px 10 10 30px;
  background: transparent;
  width: 800px;
  height: 150px;
  margin:0 auto;
  text-align: center;
  color: white;
  /* border: 8px double #C0ECAD; */
}

/**/
#header2 {
  border-radius: 50px;
  opacity: 100;
  height: 50px;
  width: 600px;
  margin:0 auto;
  text-align: center;
  color: white;
  font-size: 30px;
  font-family: 'Orbitron', sans-serif;
  text-shadow: 2px 2px 2px #999;
}

/**/
#rcornersimg {
  border-radius: 50px;
  background: black;
  border: 9px double #484E5E;
  width: 500px;
  height: 500px;
  margin: 20px auto 50px auto;
  text-align: center;
  color: white;
  padding: 0 auto;
}

/**/
.footer {
   left:0; bottom:0; right:0;
   width: 100%;
   background-color: gray;
   opacity: 0.7;
   color: white;
   text-align: center;
   font-family: "Helvetica";
   font-weight: 100;
   margin-top: 100px;
}

.searchBox {
  background-color: #FFFFFF;
  border-radius: 25px;
  border: 1px solid;
  border-color: white;
  margin: 15px 10px 10px 30px;
  width: 400px;
  height: 20px;
  font-size: 18px;
  font-family: "Helvetica";
  font-weight: 100;
  padding: 16px 15px 15px 15px;
  position: absolute;
}

.mapInputs {
  background-color: #FFFFFF;
  border-radius: 25px;
  border: 1px solid;
  border-color: white;
  margin: 7px 5px 5px 10px;
  width: 170px;
  height: 27px;
  font-size: 15px;
  font-family: "Helvetica";
  font-weight: 100;
  padding: 5px 5px 5px 10px;
  position: absolute;
}

/**/
.container{
  position: relative;
  width: 100%;
  min-height: 100vh;
  justify-content: center;
  align-items: center;
  transition:0.3s;
  padding: 20px;
}
.container#blur.active{
    filter: blur(15px);
    pointer-events: none;
    user-select: none;
}
.container.content{
  position: relative;
  max-width: 800px;
}

/**/
a{
  position: relative;
  border-radius:
  padding: 10px 24px;
  display: inline-block;
  margin-top:20px;
  text-decoration: none;
  background-color: transparent;
  border: 3px solid #C0ECAD;
  border-radius: 50px;
  color: white ;
  padding: 10px 24px;
  cursor: pointer;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  font-family: "Helvetica";
}
a:hover{
    background-color: lightgray;
}

/**/
#popup{
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  width: 400px;
  padding:50px;
  box-shadow: 0 5px 30px rgba(0,0,0,.30);
  background: gray;
  visibility: hidden;
  opacity: 1;
  transition: 0.5s;
  color: black;
  border: 9px double #C0ECAD;
}
#popup.active{
  visibility: visible;
  opacity: 1;
  transition: 0.2s;
}

/**/
.dropdownbutton {
  background-color: transparent;
  width: 500px;
  opacity: 1.0;
  color: white;
  padding: 0px;
  font-size: 18px;
  font-family: monospace;
  border-radius: 30px;
  border: 3px solid #C0ECAD;
}
.dropdown {
  position: relative;
  display: inline-block;
  z-index:999
}
.dropdown-content {
  display: none;
  position: absolute;
  opacity: 0.7;
  min-width: 160px;
  border-radius: 25px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
}
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}
.dropdown-content a:hover {background-color: darkgray;}
.dropdown:hover .dropdown-content {display: block;}
.dropdown:hover .dropdownbutton {background-color: darkgray;}

</style>
</head>

<body>

  <div class = "container" id="blur">
   <div class = "content">

     <h1>Can I see the
        <div class="dropdown">
        <button class="dropdownbutton"><h1><span id="satname1"></span></h1></button>
        <div class="dropdown-content">
          <a href="#"><button onclick="titlesat('ISS','25544');resetlatlong();"> <h2>ISS</h2> </button> </a>
          <a href="#"><button onclick="titlesat('GALILEO 26','43565');resetlatlong();"> <h2>GALILEO 26</h2> </button></a>
          <a href="#"><button onclick="titlesat('YAOGAN-31 A','43275');resetlatlong();"> <h2>YAOGAN-31 A</h2> </button></a>
        </div>
        </div> ?
     </h1>

      <script>
      document.getElementById("satname1").innerHTML="Choose a Satellite";
      function titlesat(sat_name,satel_id){
      var satel=sat_name;
      document.getElementById("satname1").innerHTML=satel;
      document.getElementById("satname").innerHTML=satel;
      document.getElementById("satname2").innerHTML=satel;
      sat_key=satel_id
      }
      </script>

      <div>
        <input
           id="searchTextField"
           class="searchBox"
           type="search"
           placeholder="Enter a location">
      </div>
      <div>
        <input
          id="ulat"
          class="mapInputs"
          type="search"
          placeholder="Latitude">
        <input
          id="ulong"
          class="mapInputs"
          type="search"
          placeholder="Longitude">
      </div>
      <div id="map"> </div>

      <style>
      /* style and size setting for the google map */
      #map {
        height:350px;
        width:100%;
      }
      </style>
      <br>

      <div class="textbox">
        <!-- <form>
          <br>
          <br>
          manual input box for user latitude
          <label>Latitude:</label>
          <input type="text" id="ulat"/>
          &emsp;
          manual input box for user longitude
          <label>Longitude:</label>
          <input type="text" id="ulong"/>
          &emsp;
        </form> -->
          <a href="#" onclick="toggle(); myFunction(); calc(); latlonginput(); resetCounter(); counter(); reset(); markerPosition(); clouds();">COMPUTE</a>
          <br>
          <p id="comp"></p>
      </div>

        <br>
      <div style = "position: relative; top:0px;" id = "header2">
        <br>
        <hr style="border: 4px double #C0ECAD;" />
        <b>Behind The Scenes</b>
        <hr style="border: 4px double #C0ECAD;" />
        <img src="/Calc_FOV.gif" style = "width:500px; height:500px;" id ="rcornersimg">
      </div>

      <br><br>
      <br><br>
        <div style = "position: relative; top:500px;", class="footer">
          <p>Coded By: David Li, Katie Stadler, Renita John;&emsp;
          With Thanks To: Ned Rossman, Nadim El-Jaroudi;&emsp;
          And Sponsored By: The UVA DevHub</p>
        </div>

      </div>
    </div>

  <div id="popup">
     <p><b>Date & Time: </b><span id="datetime"></span></p>

      <div><p>
        <b>Location of <span id="satname"></span>:</b> <br>
        Latitude: <span id="sat_latitude"> </span>
        <br>
        Longitude: <span id="sat_longitude"> </span></p>
      </div>

      <p><b>Can I see it? </b><span style="color:#C0ECAD; font-size: 25px" id="result_sat"></span></p>
      <p><b>Weather Description: </b><span id="cloud_descrip"></span></p>
      <p><b> Percent(%) Cloudiness: </b> <span id=cloud_perc></span> </p>
      <p><b>Time since last request for <span id="satname2"></span> position: </b><span id="count"> </span></p>
      <a href="#" onclick="toggle()">Close</a>
  </div>

  <script type="text/javascript">
    function toggle(){
      var blur = document.getElementById('blur');
      blur.classList.toggle('active')
      var popup = document.getElementById('popup');
      popup.classList.toggle('active')
    }
  </script>

  <script>
    var maplat; // describes the latitude pulled from the google map
    var maplong; // describes the longitude pulled from the google map
    var marker; // describes the google map marker
    var map; // describes the google map
    /* function that initializes the google map, google autocomplete search bar,
    and the google map marker. takes no parameters. */
    function initMap() {
      var latlong = new google.maps.LatLng(38.031078, -78.512772); // default location for google map marker
      var options = {
        zoom: 12,
        center: latlong
      }
      map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 38.031078, lng: -78.512772},
      zoom: 4,
      styles: [
        {elementType: 'geometry', stylers: [{color: '#242F3E'}]},
        {elementType: 'labels.text.stroke', stylers: [{color: '#242F3E'}]},
        {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
        {
          featureType: 'administrative.locality',
          elementType: 'labels.text.fill',
          stylers: [{color: '#d59563'}]
        },
        {
          featureType: 'poi',
          elementType: 'labels.text.fill',
          stylers: [{color: '#d59563'}]
        },
        {
          featureType: 'poi.park',
          elementType: 'geometry',
          stylers: [{color: '#263c3f'}]
        },
        {
          featureType: 'poi.park',
          elementType: 'labels.text.fill',
          stylers: [{color: '#6b9a76'}]
        },
        {
          featureType: 'road',
          elementType: 'geometry',
          stylers: [{color: '#38414e'}]
        },
        {
          featureType: 'road',
          elementType: 'geometry.stroke',
          stylers: [{color: '#212a37'}]
        },
        {
          featureType: 'road',
          elementType: 'labels.text.fill',
          stylers: [{color: '#9ca5b3'}]
        },
        {
          featureType: 'road.highway',
          elementType: 'geometry',
          stylers: [{color: '#746855'}]
        },
        {
          featureType: 'road.highway',
          elementType: 'geometry.stroke',
          stylers: [{color: '#1f2835'}]
        },
        {
          featureType: 'road.highway',
          elementType: 'labels.text.fill',
          stylers: [{color: '#f3d19c'}]
        },
        {
          featureType: 'transit',
          elementType: 'geometry',
          stylers: [{color: '#2f3948'}]
        },
        {
          featureType: 'transit.station',
          elementType: 'labels.text.fill',
          stylers: [{color: '#d59563'}]
        },
        {
          featureType: 'water',
          elementType: 'geometry',
          stylers: [{color: '#17263c'}]
        },
        {
          featureType: 'water',
          elementType: 'labels.text.fill',
          stylers: [{color: '#515c6d'}]
        },
        {
          featureType: 'water',
          elementType: 'labels.text.stroke',
          stylers: [{color: '#17263c'}]
        }
      ]
    });

      var input = document.getElementById('searchTextField'); // user input from the google autocomplete search bar
      var manualLat = document.getElementById('ulat');
      var manualLng = document.getElementById('ulong');

      map.controls[google.maps.ControlPosition.LEFT_TOP].push(manualLat);
      map.controls[google.maps.ControlPosition.LEFT_TOP].push(manualLng);

      map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
      var autocomplete = new google.maps.places.Autocomplete(input);
      autocomplete.bindTo('bounds', map);

      // google map marker
      marker = new google.maps.Marker({
        position: latlong,
        map: map,
        draggable: true, // user can freely drag the marker around the map
        animation: google.maps.Animation.DROP // marker drops onto the screen
      });

      autocomplete.addListener('place_changed', function() {
        var place = autocomplete.getPlace();
        /* if the user enters an unknown address into the google autocomplete
        search bar an invalid address message will print */
        if (!place.geometry) {
          document.getElementById('comp').innerHTML = "Invalid address: " + input.value;
          return;
        }
        /* setting the bounds of the map according to user input and placing the
        marker at the user's provided address */
        map.fitBounds(place.geometry.viewport);
        marker.setPosition(place.geometry.location);
        marker.setVisible(true);

        maplat = marker.getPosition().lat(); // latitude from the google map
        maplong = marker.getPosition().lng(); // longitude from the google map
        document.getElementById('ulat').value = ""; // clearing the latitude input box
        document.getElementById('ulong').value = ""; // clearing the longitude input box
        userlat = maplat; // setting user latitude equal to the latitude pulled from the google map
        userlong = maplong; // setting user longitude equal to the longitude pulled from the google map
        document.getElementById('comp').innerHTML= "Address: " + input.value + ". Latitude and longitude: " + userlat + ", " + userlong;
      });

      /* allows the user to select a place on the map by clicking on the map */
      google.maps.event.addListener(map, 'click', function(event) {
        placeMarker(event.latLng);
        maplat = marker.getPosition().lat(); // latitude from the google map
        maplong = marker.getPosition().lng(); // longitude from the google map
        document.getElementById('ulat').value = ""; // clearing the latitude input box
        document.getElementById('ulong').value = ""; // clearing the longitude input box
        userlat = maplat; // setting user latitude equal to the latitude pulled from the google map
        userlong = maplong; // setting user longitude equal to the longitude pulled from the google map
        /* printing out the user latitude and longitude */
        document.getElementById('comp').innerHTML = "User latitude and longitude: " + userlat + ", " + userlong;
      });

      /* allows the user to select a place on the map by dragging the google map marker*/
      google.maps.event.addListener(marker, 'dragend', function() {
        maplat = marker.getPosition().lat(); // latitude from the google map
        maplong = marker.getPosition().lng(); // longitude from the google map
        document.getElementById('ulat').value = ""; // clearing the latitude input box
        document.getElementById('ulong').value = ""; // clearing the longitude input box
        userlat = maplat; // setting user latitude equal to the latitude pulled from the google map
        userlong = maplong; // setting user longitude equal to the longitude pulled from the google map
        /* printing out the user latitude and longitude */
        document.getElementById('comp').innerHTML = "User latitude and longitude: " + userlat + ", " + userlong;
      });

      /* function that takes a location and places a marker on the location */
      function placeMarker(location) {
        /* if a marker has not yet been created then a new marker is created and
        placed at the given loaction */
        if (marker == undefined) {
          marker = new google.maps.Marker({
            position: location,
            map: map,
            animation: google.maps.Animation.DROP,
          });
        } else {
          /* if a marker has already been created then the marker's location is
          moved to the provided location */
          marker.setPosition(location);
          userlat = marker.getPosition().lat(); // setting the user latitude to the marker's latitude
          userlong = marker.getPosition().lng(); // setting the user longitude to the marker's longitude
          /* checks to ensure the latitude and longitude are correctly assigned */
          console.log("TEST LAT: " + marker.getPosition().lat() + " check equals " + userlat);
          console.log("TEST LONG: " + marker.getPosition().lng() + " check equals " + userlong);
        }
        map.setCenter(location); // centering the map on the provided location
      }
    }

    /* function that resets the maplat and maplong variables. this function also
    resets the google autocomplete search bar everytime the compute button is clicked. */
    function reset() {
      maplat = "";
      maplong = "";
      document.getElementById('searchTextField').value = "";
    }

    /* function that centers the marker/map around the user latitude and longitude. */
    function markerPosition() {
      /* if the user inputs latitude and longitude (the userlat and userlong variables
      are not empty) then the marker/map center around the provided latitude/longitude */
      if (userlat && userlong) {
        // creating a google LatLng object
        myLatLng = new google.maps.LatLng({lat: parseFloat(userlat), lng: parseFloat(userlong)});
        marker.setPosition(myLatLng);
        map.setCenter(myLatLng);
        map.setZoom(5); 
      }
    }
  </script>

  <!-- calling the google map api -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCT6pTAuib-JSgt6j1obhJsrcbPm_dxt1s&libraries=places&callback=initMap" async defer>
  </script>
  <br>

  <!--<div class="compute">
    <button onclick="myFunction(); calc(); latlonginput(); resetCounter(); counter(); reset(); markerPosition(); clouds();">COMPUTE</button>
  </div>-->

  <script>
  var userlat; // describes the user's latitude
  var userlong; // describes the user's longitude
  var inputLat = ""; // describes the manually inputted latitude
  var inputLong = ""; // describes the manually inputted longitude
  /* function that controls the manual input of latitude and longitude. displays
  inputted values on the screen and controls user input. */
  function latlonginput() {
    var result; // describes the combined user latitude and longitude
    inputLat = document.getElementById('ulat').value; // pulling user latitude from input box
    inputLong = document.getElementById('ulong').value; // pulling user longitude from input box
    /* only executes if the user has not yet entered information into the google
    auto complete search bar. if information has already been entered into the
    google autocomplete search bar when compute is pressed, that data will be used
    for calculations */
    if (maplat == "" && maplong == "" || maplat == undefined && maplong == undefined) {
      // executes if the input textboxes contain data
      if (inputLat !== "" && inputLong !== "") {
        // ensuring that the inputted values are numbers
        if (-91 < parseFloat(inputLat) < 91 && -181 < parseFloat(inputLong) < 181) {
          userlat = inputLat; // setting user latitude equal to the inputted value
          userlong = inputLong; // setting user longitude equal to the inputted value
          result = userlat + ", " + userlong;
          // displaying the inputted user latitude and longitude
          document.getElementById('comp').innerHTML="User latitude and longitude: " + result;
          /* reseting the input boxes after compute is pressed */
          document.getElementById('ulat').value = "";
          document.getElementById('ulong').value = "";
        }
        /* executes if the user inputted non-number data into text fields */
        else {
          document.getElementById('comp').innerHTML = "Please enter a valid number."
        }
      }
      /* executes if compute is pressed and both input boxes are empty */
      else if (inputLat == "" && inputLong == "") {
        userlat = inputLat;
        userlong = inputLong;
        document.getElementById('comp').innerHTML="Please enter a latitude and longitude.";
      }
      /* executes if compute is pressed and the longitude textbox is empty */
      else if (inputLong == "") {
        userlat = inputLat;
        userlong = inputLong;
        document.getElementById('comp').innerHTML="Please enter a longitude.";
      }
      /* executes if compute is pressed and the latitude textbox is empty */
      else {
        userlat = inputLat;
        userlong = inputLong;
        document.getElementById('comp').innerHTML="Please enter a latitude.";
      }
    }
  }
  </script>

  <script>
  function myFunction() {
    var dt = new Date();
    document.getElementById("datetime").innerHTML = (("0"+dt.getDate()).slice(-2)) +"/"+ (("0"+(dt.getMonth()+1)).slice(-2)) +"/"+ (dt.getFullYear()) +" "+ (("0"+dt.getHours()).slice(-2)) +":"+ (("0"+dt.getMinutes()).slice(-2));
  }
  </script>

  <script>
  var count = null;
  function counter(){
   var i = 0;
   count = setInterval(() => {
     document.getElementById("count").innerHTML = i;
     i+=1;
   }, 1000);
  }
  /* resets the counter everytime compute is pressed */
  function resetCounter() {
    clearInterval(count);
  }
 </script>

</body>


<script>
  function resetlatlong(){
  document.getElementById("sat_longitude").innerHTML = "";
  document.getElementById("sat_latitude").innerHTML = "";
  document.getElementById("result_sat").innerHTML = ""
  }

  function calc(){
  fetch("https://www.n2yo.com/rest/v1/satellite/positions/"+sat_key+"/"+userlat+"/"+userlong+"/0/1/&apiKey=UG67VU-3MRS33-SWNLRM-4I6R").then(r => r.json()).then(data => {

  var long = data.positions[0].satlongitude;
  var lat = data.positions[0].satlatitude;

  document.getElementById("sat_longitude").innerHTML = long.toFixed(4);
  document.getElementById("sat_latitude").innerHTML = lat.toFixed(4);

  const earthradkm = 6371
  var satalt = data.positions[0].sataltitude;
  var distkmarc = earthradkm*Math.acos(earthradkm/(earthradkm+satalt))
  var degreesdist = distkmarc*1000*0.0001/11.1

  var ulong = userlong;
  var ulat = userlat;
  console.log("Cheking latitude: " + ulat);
  console.log("Checking longitude: " + ulong);
  var num_long = parseFloat(long);
  var num_lat = parseFloat(lat)
  var num_ulong = parseFloat(ulong)
  var num_ulat = parseFloat(ulat)
  var x_cir = num_long - num_ulong
  var y_cir = num_lat - num_ulat
  var visioncheck = Math.pow(x_cir,2) + Math.pow(y_cir,2)
  if (visioncheck<=Math.pow(degreesdist.toFixed(4),2)){
    document.getElementById("result_sat").innerHTML = "Yes"
  }else{
    document.getElementById("result_sat").innerHTML = "No"
  }
})
}

function clouds(){
  fetch("https://api.openweathermap.org/data/2.5/weather?lat="+userlat+"&lon="+userlong+"&appid=658295ed6de928f64794e23ee97cab06").then(r_weath => r_weath.json()).then(data_weath => {
      var cloudy_desc = data_weath.weather[0].description;
      var cloudy = data_weath.clouds.all;
      document.getElementById("cloud_descrip").innerHTML = cloudy_desc;
      if(cloudy<=33){
      document.getElementById("cloud_perc").innerHTML = cloudy+", There is likely light to no cloud coverage";
    }else if (cloudy<=66) {
      document.getElementById("cloud_perc").innerHTML = cloudy+", There is likely mid to heavy cloud coverage";
    }else{
      document.getElementById("cloud_perc").innerHTML = cloudy+", There is likely very heavy cloud coverage";
    }
  })
}
</script>

</html>
